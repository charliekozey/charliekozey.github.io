<!doctype html>
<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

	<title>PATCH and DELETE Requests</title>

	<link rel="stylesheet" href="dist/reset.css">
	<link rel="stylesheet" href="dist/reveal.css">
	<link rel="stylesheet" href="dist/theme/moon.css">

	<!-- Theme used for syntax highlighted code -->
	<link rel="stylesheet" href="plugin/highlight/monokai.css">
</head>

<body>
	<div class="reveal">	
		<div class="slides">
			<section data-markdown>
		<textarea data-template>
		# PATCH and DELETE Requests
		slides by Charlie Kozey
		---
		## Goals
		By the end of this lecture, you should be able to:
		- send a POST request using HTML forms and JavaScript
		- send a PATCH request using HTML forms and JavaScript
		- send a DELETE request using HTML buttons and JavaScript
		- explain the difference between optimistic and pessimistic rendering
		---
		## Agenda
		1. Anatomy of POST/PATCH/DELETE
		2. Build from the ground up: [Cookie CRUD](https://github.com/charliekozey/cookie-app)
			- [ ] GET - show all cookies
			- [ ] POST - add a new cookie
			- [ ] DELETE - remove a cookie
			- [ ] PATCH 1 - toggle favorite
			- [ ] PATCH 2 - decrement (decrease by one) number of cookies
		---
		# Part 1: Review POST
		---
		## DELETE
		- Must identify a specific object in the db to delete
		- That is, its URL endpoint should be an ID
		- We use string interpolation to achieve this
		- Only obligatory key in the config object: ```method```
		- .then is optional

		```js
		fetch(`http://localhost:3000/cookies/${cookie.id}`, {
			method: "DELETE"
		})
		```
		- Must be in scope where cookie (or whatever the item is) is defined
		---
		## PATCH
		- Like DELETE, you must specify one specific object to update
		
		```js
		fetch(`http://localhost:3000/cookies/${cookie.id}`, {
			method: "PATCH",
			headers: {
				"Content-Type": "application/json",
			},
			body: JSON.stringify({"quantity": newQuantity})
		})
			.then(res => res.json())
			.then(cookie => console.log(cookie))
		```
		- Again, must be in scope where cookie is defined
		---
		## KEY DIFFERENCES: ENDPOINTS
		endpoint: ```"/cookies"```
		- GET (to show all)
		- POST
		
		endpoint: ```"/cookies/:id"```
		- GET (to show one)
		- PATCH
		- PUT
		- DELETE
		---
		## An aside: PUT
		- Another HTTP verb
		- A way of changing an item in the db, like PATCH
		- BUT it replaces the entire target object, even if you only specify one key
		- If you leave any key/value pairs out of your request, their values will be replaced by ``` null```		
		---
		# Part 2: Optimistic vs. Pessimistic Rendering
		---
		## Optimistic vs. Pessimistic Rendering
		- The question at hand: Will the server update be successful?
		- Optimist says yes
		- Pessimist waits to be sure
		- Not necessarily better or worse; just depends on use case
		---
		## Optimistic rendering
		- Optimistic rendering renders DOM and updates server simultaneously
		- DOM updates are synchronous, so they happen first
		- Server update is async, so it happens last
		- Example: here, renderBook is not chained to fetch
		```js
		fetch(url, bookData)
		renderBook(bookData)
		```
		---
		## Optimistic rendering, continued
		- Better if you expect users to have reliable but slow connections (makes UI more responsive; updates DOM first and server update runs in background)
		- Caveat: you must be more thorough with error handling because DOM update may trick your users into thinking it worked
		Note:
		Live demo of optimistic rendering, with and without network throttling
		---
		## Pessimistic rendering
		- Pessimistic rendering updates server, waits for it to complete, then renders DOM
		- Example: here, renderBook is inside the .then(), so it waits for fetch to complete
		```js
		fetch(url, bookData)
		.then(res => res.json())
		.then(renderBook)
		```
		---
		## Pessimistic rendering, continued
		- Better if you expect users to have fast connections; simpler to execute
		- You could also write the second ```.then``` as ```.then(book => renderBook(book))```
		- QQ: Why does it work both ways?
		- Recommend using pessimistic for Phase 1, because it's simpler to debug
		---
		# Part 3: [Cookie CRUD](https://github.com/charliekozey/cookie-app) demo
		---
		### Goals reflection:
		Can you...?
		- send a POST request using HTML forms and JavaScript
		- send a PATCH request using HTML forms and JavaScript
		- send a DELETE request using HTML buttons and JavaScript
		- explain the difference between optimistic and pessimistic rendering
		</textarea>
	</section>
		</div>
	</div>

	<script src="dist/reveal.js"></script>
	<script src="plugin/notes/notes.js"></script>
	<script src="plugin/markdown/markdown.js"></script>
	<script src="plugin/highlight/highlight.js"></script>
	<script>
		// More info about initialization & config:
		// - https://revealjs.com/initialization/
		// - https://revealjs.com/config/
		Reveal.initialize({
			hash: true,

			// Learn about plugins: https://revealjs.com/plugins/
			plugins: [RevealMarkdown, RevealHighlight, RevealNotes]
		});
	</script>
</body>

</html>